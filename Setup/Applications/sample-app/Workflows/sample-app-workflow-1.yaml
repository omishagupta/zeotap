harnessApiVersion: '1.0'
type: MULTI_SERVICE
envName: GKE
failureStrategies:
- executionScope: WORKFLOW
  failureTypes:
  - APPLICATION_ERROR
  repairActionCode: ROLLBACK_WORKFLOW
  retryCount: 0
notificationRules:
- conditions:
  - FAILED
  executionScope: WORKFLOW
  notificationGroupAsExpression: false
  userGroupAsExpression: false
  userGroupIds:
  - NrpTXUerQamXn5KqbUNXig
phases:
- type: KUBERNETES
  computeProviderName: connection-by-omisha
  daemonSet: false
  infraMappingName: us-central1-a_harness -GCP_Kubernetes--Google Cloud Platform- connection-by-omisha- harness-delegate
  name: Canary
  phaseSteps:
  - type: K8S_PHASE_STEP
    name: Deploy
    steps:
    - type: K8S_CANARY_DEPLOY
      name: Canary Deployment
      properties:
        instanceUnitType: COUNT
        instances: '1'
    stepsInParallel: false
  - type: K8S_PHASE_STEP
    name: Verify
    stepsInParallel: false
  - type: K8S_PHASE_STEP
    name: Wrap Up
    steps:
    - type: K8S_DELETE
      name: Canary Delete
      properties:
        instanceUnitType: COUNT
        resources: ${k8s.canaryWorkload}
    stepsInParallel: false
  provisionNodes: false
  serviceName: sample-app-service-1
  statefulSet: false
postDeploymentSteps:
- type: SHELL_SCRIPT
  name: Shell Script
  properties:
    commandPath: null
    connectionAttributes: null
    executeOnDelegate: true
    host: null
    outputVars: ''
    publishAsVar: false
    scriptString: '# deploy that application on kubernetes'
    scriptType: BASH
    sshKeyRef: null
    sweepingOutputName: null
    sweepingOutputScope: null
    tags: ''
    templateVariables: ''
    timeoutMillis: 60000
preDeploymentSteps:
- type: SHELL_SCRIPT
  name: Shell Script
  properties:
    commandPath: null
    connectionAttributes: null
    executeOnDelegate: true
    host: null
    outputVars: ''
    publishAsVar: false
    scriptString: |-
      cp Setup/Applications/sample-app .
      #create docker image out of code
    scriptType: BASH
    sshKeyRef: null
    sweepingOutputName: null
    sweepingOutputScope: null
    tags: ''
    templateVariables: ''
    timeoutMillis: 60000
rollbackPhases:
- type: KUBERNETES
  computeProviderName: connection-by-omisha
  daemonSet: false
  infraMappingName: us-central1-a_harness -GCP_Kubernetes--Google Cloud Platform- connection-by-omisha- harness-delegate
  name: Rollback Canary
  phaseNameForRollback: Canary
  phaseSteps:
  - type: K8S_PHASE_STEP
    name: Deploy
    phaseStepNameForRollback: Deploy
    statusForRollback: SUCCESS
    stepsInParallel: false
  - type: K8S_PHASE_STEP
    name: Wrap Up
    phaseStepNameForRollback: Wrap Up
    stepsInParallel: false
  provisionNodes: false
  serviceName: sample-app-service-1
  statefulSet: false
templatized: false
